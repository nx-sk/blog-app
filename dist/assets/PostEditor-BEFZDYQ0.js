import{r as d,j as e,a3 as Qe,a4 as et,O as ae,a5 as Le,a6 as de,a7 as ue,a8 as tt,a9 as L,Z as y,aa as Se,J as Q,K as st,M as Ne,N as V,ab as at,ac as rt,ad as nt,S as ot,k as it,w as ze,a0 as he,s as G,V as me,B as N,T as ie,H as T,m as H,e as w,D as te,v as lt,P as ct,b as dt,c as Ce,y as ut,ae as Fe,d as ht,af as Ie,ag as Re}from"./index-BSHOxWij.js";import{T as $e}from"./textarea-v1XwlEx4.js";import{w as De,T as le,u as mt,f as gt,M as Te,b as Be,a as He,c as Oe,d as Ue,e as pt}from"./modal-overlay-DNcbSzXw.js";import{a as ft,b as Ae,c as xt,F as K,I as se}from"./input-DxyQ8RI6.js";import{M as bt,r as yt}from"./index-DM7SUguo.js";import{H as kt}from"./heading-Bmwyqq1n.js";import{S as jt}from"./simple-grid-CVlM4JfI.js";import"./grid-BhVHQ1Lv.js";const wt=s=>s!=null&&parseInt(s.toString(),10)>0,Pe={exit:{height:{duration:.2,ease:le.ease},opacity:{duration:.3,ease:le.ease}},enter:{height:{duration:.3,ease:le.ease},opacity:{duration:.4,ease:le.ease}}},vt={exit:({animateOpacity:s,startingHeight:c,transition:o,transitionEnd:a,delay:i})=>({...s&&{opacity:wt(c)?1:0},height:c,transitionEnd:a==null?void 0:a.exit,transition:(o==null?void 0:o.exit)??De.exit(Pe.exit,i)}),enter:({animateOpacity:s,endingHeight:c,transition:o,transitionEnd:a,delay:i})=>({...s&&{opacity:1},height:c,transitionEnd:a==null?void 0:a.enter,transition:(o==null?void 0:o.enter)??De.enter(Pe.enter,i)})},We=d.forwardRef((s,c)=>{const{in:o,unmountOnExit:a,animateOpacity:i=!0,startingHeight:m=0,endingHeight:b="auto",style:S,className:v,transition:k,transitionEnd:f,animatePresenceProps:C,...R}=s,[P,h]=d.useState(!1);d.useEffect(()=>{const $=setTimeout(()=>{h(!0)});return()=>clearTimeout($)},[]);const x=parseFloat(m.toString())>0,I={startingHeight:m,endingHeight:b,animateOpacity:i,transition:P?k:{enter:{duration:0}},transitionEnd:{enter:f==null?void 0:f.enter,exit:a?f==null?void 0:f.exit:{...f==null?void 0:f.exit,display:x?"block":"none"}}},F=a?o:!0,z=o||a?"enter":"exit";return e.jsx(Qe,{...C,initial:!1,custom:I,children:F&&e.jsx(et.div,{ref:c,...R,className:ae("chakra-collapse",v),style:{overflow:"hidden",display:"block",...S},custom:I,variants:vt,initial:a?"exit":!1,animate:z,exit:"exit"})})});We.displayName="Collapse";var St=()=>typeof document<"u",Me=!1,re=null,Z=!1,ge=!1,pe=new Set;function be(s,c){pe.forEach(o=>o(s,c))}var Ct=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function Ft(s){return!(s.metaKey||!Ct&&s.altKey||s.ctrlKey||s.key==="Control"||s.key==="Shift"||s.key==="Meta")}function _e(s){Z=!0,Ft(s)&&(re="keyboard",be("keyboard",s))}function X(s){if(re="pointer",s.type==="mousedown"||s.type==="pointerdown"){Z=!0;const c=s.composedPath?s.composedPath()[0]:s.target;let o=!1;try{o=c.matches(":focus-visible")}catch{}if(o)return;be("pointer",s)}}function It(s){return s.mozInputSource===0&&s.isTrusted?!0:s.detail===0&&!s.pointerType}function Rt(s){It(s)&&(Z=!0,re="virtual")}function Dt(s){s.target===window||s.target===document||s.target instanceof Element&&s.target.hasAttribute("tabindex")||(!Z&&!ge&&(re="virtual",be("virtual",s)),Z=!1,ge=!1)}function Pt(){Z=!1,ge=!0}function Ee(){return re!=="pointer"}function Mt(){if(!St()||Me)return;const{focus:s}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...o){Z=!0,s.apply(this,o)},document.addEventListener("keydown",_e,!0),document.addEventListener("keyup",_e,!0),document.addEventListener("click",Rt,!0),window.addEventListener("focus",Dt,!0),window.addEventListener("blur",Pt,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",X,!0),document.addEventListener("pointermove",X,!0),document.addEventListener("pointerup",X,!0)):(document.addEventListener("mousedown",X,!0),document.addEventListener("mousemove",X,!0),document.addEventListener("mouseup",X,!0)),Me=!0}function _t(s){Mt(),s(Ee());const c=()=>s(Ee());return pe.add(c),()=>{pe.delete(c)}}const Et={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Lt(s={}){const c=ft(s),{isDisabled:o,isReadOnly:a,isRequired:i,isInvalid:m,id:b,onBlur:S,onFocus:v,"aria-describedby":k}=c,{defaultChecked:f,isChecked:C,isFocusable:R,onChange:P,isIndeterminate:h,name:x,value:I,tabIndex:F=void 0,"aria-label":z,"aria-labelledby":$,"aria-invalid":O,...Y}=s,U=Le(Y,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),q=de(P),M=de(S),J=de(v),[_,A]=d.useState(!1),[t,r]=d.useState(!1),[n,l]=d.useState(!1),g=d.useRef(!1);d.useEffect(()=>_t(u=>{g.current=u}),[]);const p=d.useRef(null),[j,ee]=d.useState(!0),[Ve,ne]=d.useState(!!f),ce=C!==void 0,D=ce?C:Ve,ke=d.useCallback(u=>{if(a||o){u.preventDefault();return}ce||ne(D?u.currentTarget.checked:h?!0:u.currentTarget.checked),q==null||q(u)},[a,o,D,ce,h,q]);ue(()=>{p.current&&(p.current.indeterminate=!!h)},[h]),tt(()=>{o&&A(!1)},[o,A]),ue(()=>{const u=p.current;if(!(u!=null&&u.form))return;const E=()=>{ne(!!f)};return u.form.addEventListener("reset",E),()=>{var B;return(B=u.form)==null?void 0:B.removeEventListener("reset",E)}},[]);const je=o&&!R,we=d.useCallback(u=>{u.key===" "&&l(!0)},[l]),ve=d.useCallback(u=>{u.key===" "&&l(!1)},[l]);ue(()=>{if(!p.current)return;p.current.checked!==D&&ne(p.current.checked)},[p.current]);const Ye=d.useCallback((u={},E=null)=>{const B=oe=>{_&&oe.preventDefault(),l(!0)};return{...u,ref:E,"data-active":y(n),"data-hover":y(t),"data-checked":y(D),"data-focus":y(_),"data-focus-visible":y(_&&g.current),"data-indeterminate":y(h),"data-disabled":y(o),"data-invalid":y(m),"data-readonly":y(a),"aria-hidden":!0,onMouseDown:L(u.onMouseDown,B),onMouseUp:L(u.onMouseUp,()=>l(!1)),onMouseEnter:L(u.onMouseEnter,()=>r(!0)),onMouseLeave:L(u.onMouseLeave,()=>r(!1))}},[n,D,o,_,t,h,m,a]),Ge=d.useCallback((u={},E=null)=>({...u,ref:E,"data-active":y(n),"data-hover":y(t),"data-checked":y(D),"data-focus":y(_),"data-focus-visible":y(_&&g.current),"data-indeterminate":y(h),"data-disabled":y(o),"data-invalid":y(m),"data-readonly":y(a)}),[n,D,o,_,t,h,m,a]),Ze=d.useCallback((u={},E=null)=>({...U,...u,ref:Se(E,B=>{B&&ee(B.tagName==="LABEL")}),onClick:L(u.onClick,()=>{var B;j||((B=p.current)==null||B.click(),requestAnimationFrame(()=>{var oe;(oe=p.current)==null||oe.focus({preventScroll:!0})}))}),"data-disabled":y(o),"data-checked":y(D),"data-invalid":y(m)}),[U,o,D,m,j]),Je=d.useCallback((u={},E=null)=>({...u,ref:Se(p,E),type:"checkbox",name:x,value:I,id:b,tabIndex:F,onChange:L(u.onChange,ke),onBlur:L(u.onBlur,M,()=>A(!1)),onFocus:L(u.onFocus,J,()=>A(!0)),onKeyDown:L(u.onKeyDown,we),onKeyUp:L(u.onKeyUp,ve),required:i,checked:D,disabled:je,readOnly:a,"aria-label":z,"aria-labelledby":$,"aria-invalid":O?!!O:m,"aria-describedby":k,"aria-disabled":o,"aria-checked":h?"mixed":D,style:Et}),[x,I,b,F,ke,M,J,we,ve,i,D,je,a,z,$,O,m,k,o,h]),Xe=d.useCallback((u={},E=null)=>({...u,ref:E,onMouseDown:L(u.onMouseDown,Nt),"data-disabled":y(o),"data-checked":y(D),"data-invalid":y(m)}),[D,o,m]);return{state:{isInvalid:m,isFocused:_,isChecked:D,isActive:n,isHovered:t,isIndeterminate:h,isDisabled:o,isReadOnly:a,isRequired:i},getRootProps:Ze,getCheckboxProps:Ye,getIndicatorProps:Ge,getInputProps:Je,getLabelProps:Xe,htmlProps:U}}function Nt(s){s.preventDefault(),s.stopPropagation()}const W=Q(function(c,o){const a=st("FormLabel",c),i=Ne(c),{className:m,children:b,requiredIndicator:S=e.jsx(qe,{}),optionalIndicator:v=null,...k}=i,f=Ae(),C=(f==null?void 0:f.getLabelProps(k,o))??{ref:o,...k};return e.jsxs(V.label,{...C,className:ae("chakra-form__label",i.className),__css:{display:"block",textAlign:"start",...a},children:[b,f!=null&&f.isRequired?S:v]})});W.displayName="FormLabel";const qe=Q(function(c,o){const a=Ae(),i=xt();if(!(a!=null&&a.isRequired))return null;const m=ae("chakra-form__required-indicator",c.className);return e.jsx(V.span,{...a==null?void 0:a.getRequiredIndicatorProps(c,o),__css:i.requiredIndicator,className:m})});qe.displayName="RequiredIndicator";const fe=Q(function(c,o){const{htmlWidth:a,htmlHeight:i,alt:m,...b}=c;return e.jsx("img",{width:a,height:i,ref:o,alt:m,...b})});fe.displayName="NativeImage";const xe=Q(function(c,o){const{fallbackSrc:a,fallback:i,src:m,srcSet:b,align:S,fit:v,loading:k,ignoreFallback:f,crossOrigin:C,fallbackStrategy:R="beforeLoadOrError",referrerPolicy:P,...h}=c,x=a!==void 0||i!==void 0,I=k!=null||f||!x,F=at({...c,crossOrigin:C,ignoreFallback:I}),z=rt(F,R),$={ref:o,objectFit:v,objectPosition:S,...I?h:Le(h,["onError","onLoad"])};return z?i||e.jsx(V.img,{as:fe,className:"chakra-image__placeholder",src:a,...$}):e.jsx(V.img,{as:fe,src:m,srcSet:b,crossOrigin:C,loading:k,referrerPolicy:P,className:"chakra-image",...$})});xe.displayName="Image";const ye=Q((s,c)=>{const{onClick:o,className:a,...i}=s,{onClose:m}=mt(),b=ae("chakra-modal__close-btn",a),S=gt();return e.jsx(nt,{ref:c,__css:S.closeButton,className:b,onClick:L(o,v=>{v.stopPropagation(),m()}),...i})});ye.displayName="ModalCloseButton";const Ke=Q(function(c,o){const a=ot("Switch",c),{spacing:i="0.5rem",children:m,...b}=Ne(c),{getIndicatorProps:S,getInputProps:v,getCheckboxProps:k,getRootProps:f,getLabelProps:C}=Lt(b),R=d.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),P=d.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),h=d.useMemo(()=>({userSelect:"none",marginStart:i,...a.label}),[i,a.label]);return e.jsxs(V.label,{...f(),className:ae("chakra-switch",c.className),__css:R,children:[e.jsx("input",{className:"chakra-switch__input",...v({},o)}),e.jsx(V.span,{...k(),className:"chakra-switch__track",__css:P,children:e.jsx(V.span,{__css:a.thumb,className:"chakra-switch__thumb",...S()})}),m&&e.jsx(V.span,{className:"chakra-switch__label",...C(),__css:h,children:m})]})});Ke.displayName="Switch";const zt=({value:s,onChange:c,postId:o})=>{const{colorMode:a}=it(),i=ze(),m=d.useRef(null),b=d.useRef(null),{isOpen:S,onOpen:v,onClose:k}=he(),[f,C]=d.useState(""),[R,P]=d.useState(""),[h,x]=d.useState(""),[I,F]=d.useState(!0),[z,$]=d.useState([]);d.useEffect(()=>{const t=/^(#{1,6})\s+(.+)$/gm,r=[];let n;for(;(n=t.exec(s))!==null;){const l=n[1].length,g=n[2],p=g.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-");l<=2&&r.push({id:p,text:g,level:l})}$(r)},[s]);const O=d.useCallback(async t=>{try{const r=`${Date.now()}-${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,n=o?`posts/${o}/${r}`:`temp/${r}`,{data:l,error:g}=await G.storage.listBuckets();if(g)throw console.error("バケット一覧取得エラー:",g),new Error(`バケット取得エラー: ${g.message}`);if(t.size>50*1024*1024)throw new Error("ファイルサイズが大きすぎます（50MB以下にしてください）");const{data:p,error:j}=await G.storage.from("media").upload(n,t,{cacheControl:"3600",upsert:!1});if(j)throw console.error("アップロードエラー詳細:",{message:j.message,cause:j.cause,fullError:j}),console.error("エラーオブジェクト全体:",JSON.stringify(j,null,2)),j;const{data:{publicUrl:ee}}=G.storage.from("media").getPublicUrl(p.path);return ee}catch(r){return console.error("画像アップロードエラー:",r),i({title:"エラー",description:`画像のアップロードに失敗しました: ${r instanceof Error?r.message:"不明なエラー"}`,status:"error",duration:5e3,isClosable:!0}),null}},[o,i]),Y=async t=>{const r=t.target.files;if(!r||r.length===0)return;const n=r[0];if(!n.type.startsWith("image/")){i({title:"エラー",description:"画像ファイルを選択してください",status:"error",duration:3e3,isClosable:!0});return}const l=await O(n);l&&U(l)},U=d.useCallback(t=>{const r=`
![画像](${t})
`,n=m.current;if(n){const l=n.selectionStart,g=n.selectionEnd,p=s.slice(0,l)+r+s.slice(g);c(p),setTimeout(()=>{n.setSelectionRange(l+r.length,l+r.length),n.focus()},0)}else c(s+r);i({title:"画像を挿入しました",status:"success",duration:2e3,isClosable:!0})},[s,c,i]),q=d.useCallback(async t=>{var n;const r=(n=t.clipboardData)==null?void 0:n.items;if(r)for(let l=0;l<r.length;l++){const g=r[l];if(g.type.startsWith("image/")){t.preventDefault();const p=g.getAsFile();if(!p)continue;const j=await O(p);j&&U(j);break}}},[O,U]),M=d.useCallback((t,r="")=>{const n=m.current;if(!n)return;const l=n.selectionStart,g=n.selectionEnd,p=s.slice(l,g),j=t+p+r,ee=s.slice(0,l)+j+s.slice(g);c(ee),setTimeout(()=>{n.focus(),n.setSelectionRange(l+t.length,l+t.length+p.length)},0)},[s,c]),J=t=>{C(t);const r=t.match(/!\[([^\]]*)\]\(([^)]+)\)/);if(r){const n=new URLSearchParams(r[2].split("?")[1]||"");P(n.get("w")||""),x(n.get("h")||"")}v()},_=()=>{if(!f)return;const t=R||h?`${f.split("?")[0]}?w=${R}&h=${h}`:f,r=new RegExp(`!\\[[^\\]]*\\]\\(${f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\)`),n=`![画像](${t})`,l=s.replace(r,n);c(l),k(),C(""),P(""),x("")},A=()=>e.jsx(N,{height:"100%",overflowY:"auto",bg:a==="dark"?"gray.800":"white",color:a==="dark"?"white":"gray.800",p:4,fontSize:"sm",lineHeight:1.7,sx:{"& h1":{fontSize:"lg",fontWeight:"bold",mb:3,color:a==="dark"?"blue.300":"blue.600"},"& h2":{fontSize:"md",fontWeight:"bold",mb:2,mt:4,color:a==="dark"?"blue.300":"blue.600"},"& h3":{fontSize:"sm",fontWeight:"bold",mb:1,mt:3,color:a==="dark"?"blue.300":"blue.600"},"& p":{mb:2,lineHeight:1.7},"& ul, & ol":{mb:2,pl:5},"& li":{mb:1},"& code":{bg:a==="dark"?"gray.700":"gray.100",color:a==="dark"?"pink.300":"pink.600",px:1,py:.5,borderRadius:"sm",fontSize:"xs",fontFamily:"mono"},"& pre":{bg:a==="dark"?"gray.700":"gray.100",p:3,borderRadius:"md",overflowX:"auto",mb:2},"& a":{color:a==="dark"?"blue.300":"blue.600",textDecoration:"underline"},"& img":{maxWidth:"100%",height:"auto",borderRadius:"md",mb:2,cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)"}}},children:s?e.jsx(bt,{remarkPlugins:[yt],components:{img:({src:t,alt:r})=>e.jsx("img",{src:t,alt:r,onClick:()=>J(t||""),style:{cursor:"pointer"}}),h1:({children:t,...r})=>{const l=String(t).toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-");return e.jsx("h1",{id:l,...r,children:t})},h2:({children:t,...r})=>{const l=String(t).toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g,"-");return e.jsx("h2",{id:l,...r,children:t})}},children:s}):e.jsx(ie,{color:"gray.500",fontStyle:"italic",children:"記事を書いてください"})});return e.jsxs(me,{spacing:4,align:"stretch",h:"calc(100vh - 200px)",pr:{lg:I?"380px":0},children:[z.length>0&&e.jsxs(N,{p:4,bg:a==="dark"?"gray.700":"gray.50",borderRadius:"md",border:"1px solid",borderColor:a==="dark"?"gray.600":"gray.200",children:[e.jsx(ie,{fontWeight:"bold",mb:3,fontSize:"sm",children:"📋 目次プレビュー"}),e.jsx(T,{spacing:1,flexWrap:"wrap",children:z.map((t,r)=>e.jsxs(ie,{fontSize:"xs",color:a==="dark"?"gray.300":"gray.600",bg:a==="dark"?"gray.600":"gray.100",px:2,py:1,borderRadius:"sm",mr:t.level===1?2:0,fontWeight:t.level===1?"bold":"normal",children:[t.level===1?"# ":"## ",t.text]},t.id))})]}),e.jsx(N,{p:3,bg:a==="dark"?"gray.700":"gray.50",borderRadius:"lg",border:"1px solid",borderColor:a==="dark"?"gray.600":"gray.200",children:e.jsxs(T,{spacing:1,flexWrap:"wrap",children:[e.jsxs(T,{spacing:1,mr:2,children:[e.jsx(H,{label:"見出し1",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("# "),colorScheme:"blue",children:"H1"})}),e.jsx(H,{label:"見出し2",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("## "),colorScheme:"blue",children:"H2"})}),e.jsx(H,{label:"見出し3",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("### "),colorScheme:"blue",children:"H3"})})]}),e.jsx(te,{orientation:"vertical",height:"30px"}),e.jsxs(T,{spacing:1,mx:2,children:[e.jsx(H,{label:"太字",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("**","**"),colorScheme:"blue",children:"B"})}),e.jsx(H,{label:"斜体",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("*","*"),colorScheme:"blue",children:"I"})}),e.jsx(H,{label:"インラインコード",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("`","`"),colorScheme:"blue",children:"<>"})})]}),e.jsx(te,{orientation:"vertical",height:"30px"}),e.jsxs(T,{spacing:1,mx:2,children:[e.jsx(H,{label:"リスト",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("- "),colorScheme:"blue",children:"• List"})}),e.jsx(H,{label:"リンク",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("[","](url)"),colorScheme:"blue",children:"🔗"})})]}),e.jsx(te,{orientation:"vertical",height:"30px"}),e.jsxs(T,{spacing:1,mx:2,children:[e.jsx(H,{label:"コードブロック",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>M("```\n","\n```"),colorScheme:"blue",children:"```"})}),e.jsx(H,{label:"画像を挿入",placement:"top",children:e.jsx(w,{size:"sm",variant:"ghost",onClick:()=>{var t;return(t=b.current)==null?void 0:t.click()},colorScheme:"blue",children:"🖼️ 画像"})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",style:{display:"none"},onChange:Y})]}),e.jsx(te,{orientation:"vertical",height:"30px"}),e.jsx(N,{flex:1}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>F(t=>!t),children:I?"サイドプレビューを隠す":"サイドプレビューを表示"})]})}),e.jsx(N,{border:"2px solid",borderColor:a==="dark"?"gray.600":"gray.200",borderRadius:"md",overflow:"hidden",children:e.jsx($e,{ref:m,value:s,onChange:t=>c(t.target.value),onPaste:q,placeholder:`# タイトル

記事の内容をここに書きます...

## 見出し2

- リスト項目1
- リスト項目2

**太字** *斜体* \`コード\`

\`\`\`
コードブロック
\`\`\`

[リンク](https://example.com)

画像はCtrl+V/Cmd+Vで貼り付けるか、画像ボタンから選択できます。`,height:"100%",resize:"none",fontSize:"14px",lineHeight:"1.6",fontFamily:"'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace",bg:a==="dark"?"gray.800":"white",color:a==="dark"?"white":"gray.800",p:4,border:"none",_focus:{outline:"none"}})}),I&&e.jsx(N,{position:"fixed",right:{base:4,xl:12},top:{base:"96px",md:"110px"},w:{base:"240px",xl:"300px"},maxH:"70vh",overflowY:"auto",border:"1px solid",borderColor:a==="dark"?"gray.600":"gray.200",borderRadius:"md",bg:a==="dark"?"gray.800":"white",boxShadow:"0 8px 24px rgba(0,0,0,0.12)",zIndex:5,display:{base:"none",lg:"block"},children:e.jsx(A,{})}),e.jsxs(Te,{isOpen:S,onClose:k,children:[e.jsx(Be,{}),e.jsxs(He,{children:[e.jsx(Oe,{children:"画像サイズ調整"}),e.jsx(ye,{}),e.jsx(Ue,{children:e.jsxs(me,{spacing:4,children:[e.jsxs(K,{children:[e.jsx(W,{children:"幅 (px)"}),e.jsx(se,{type:"number",value:R,onChange:t=>P(t.target.value),placeholder:"例: 800"})]}),e.jsxs(K,{children:[e.jsx(W,{children:"高さ (px)"}),e.jsx(se,{type:"number",value:h,onChange:t=>x(t.target.value),placeholder:"例: 600"})]}),e.jsx(ie,{fontSize:"sm",color:"gray.500",children:"※ 空欄の場合は元のサイズが維持されます"})]})}),e.jsxs(pt,{children:[e.jsx(w,{variant:"ghost",mr:3,onClick:k,children:"キャンセル"}),e.jsx(w,{colorScheme:"blue",onClick:_,children:"適用"})]})]})]})]})},Kt=()=>{var A;const{id:s}=lt(),c=ct(),o=dt(),a=ze(),{currentPost:i,loading:m}=Ce(t=>t.posts),{user:b}=Ce(t=>t.auth),S=he(),v=he(),[k,f]=d.useState([]),[C,R]=d.useState(!1),P=d.useRef(null),h=!!(s&&s!=="new"),[x,I]=d.useState({title:"",slug:"",content:"",excerpt:"",featured_image:"",status:"draft"});d.useEffect(()=>(o(h&&s?ut(s):Fe()),()=>{o(Fe())}),[o,s,h]),d.useEffect(()=>{i&&h&&I({title:i.title||"",slug:i.slug||"",content:i.content||"",excerpt:i.excerpt||"",featured_image:i.featured_image||"",status:i.status||"draft"})},[i,h]);const F=(t,r)=>{if(I(n=>({...n,[t]:r})),t==="title"&&!h&&!x.slug){const n=r.toLowerCase().replace(/[^a-z0-9\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,"");I(l=>({...l,slug:n}))}},z=()=>{if(!x.title.trim()||!x.content.trim()){a({title:"エラー",description:"タイトルと本文は必須です",status:"error",duration:3e3,isClosable:!0});return}let t=x.slug.trim();if(!t){const n=new Date,l=n.getFullYear(),g=String(n.getMonth()+1).padStart(2,"0"),p=String(n.getDate()).padStart(2,"0");t=`${l}${g}${p}`}const r={...x,slug:t,author_id:(b==null?void 0:b.id)||"",published_at:x.status==="published"?new Date().toISOString():void 0};o(h&&i?Ie({id:i.id,post:r}):Re(r)),a({title:h?"記事を更新しました":"記事を作成しました",status:"success",duration:3e3,isClosable:!0}),c("/admin/posts")},$=()=>{let t=x.slug.trim();if(!t){const n=new Date,l=n.getFullYear(),g=String(n.getMonth()+1).padStart(2,"0"),p=String(n.getDate()).padStart(2,"0");t=`${l}${g}${p}`}const r={...x,slug:t,status:"draft",author_id:(b==null?void 0:b.id)||""};o(h&&i?Ie({id:i.id,post:r}):Re(r)),a({title:"下書きを保存しました",status:"success",duration:3e3,isClosable:!0})};if(m&&h)return e.jsx(ht,{});const O=async()=>{try{const t=[];h&&(i!=null&&i.id)&&t.push(`posts/${i.id}`),t.push("temp");const r=[];for(const n of t){const{data:l,error:g}=await G.storage.from("media").list(n,{limit:50,sortBy:{column:"created_at",order:"desc"}});if(!g){for(const p of l||[])if(p.name){const{data:j}=G.storage.from("media").getPublicUrl(`${n}/${p.name}`);j!=null&&j.publicUrl&&r.push(j.publicUrl)}}}f(r)}catch{}},Y=async t=>{const r=`${Date.now()}-${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,n=h&&(i!=null&&i.id)?`posts/${i.id}`:"temp",{error:l}=await G.storage.from("media").upload(`${n}/${r}`,t,{cacheControl:"3600",upsert:!1});if(l)a({title:"アップロードに失敗しました",status:"error"});else{const{data:g}=G.storage.from("media").getPublicUrl(`${n}/${r}`);g!=null&&g.publicUrl&&(F("featured_image",g.publicUrl),a({title:"アイキャッチを設定しました",status:"success",duration:2e3,isClosable:!0}))}},U=async t=>{var n;const r=(n=t.clipboardData)==null?void 0:n.items;if(r)for(let l=0;l<r.length;l++){const g=r[l];if(g.type.startsWith("image/")){t.preventDefault();const p=g.getAsFile();if(!p)continue;await Y(p);break}}},q=async t=>{t.preventDefault(),R(!1);const r=t.dataTransfer;if(r!=null&&r.files&&r.files.length>0){const n=r.files[0];n.type.startsWith("image/")?await Y(n):a({title:"画像ファイルをドロップしてください",status:"warning",duration:2e3})}},M=t=>{t.preventDefault(),R(!0)},J=()=>R(!1),_=async t=>{var n;const r=(n=t.target.files)==null?void 0:n[0];r&&r.type.startsWith("image/")&&await Y(r),t.target.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(N,{w:{base:"100%",xl:"1000px"},mr:"auto",px:4,py:6,children:e.jsxs(me,{spacing:6,align:"stretch",children:[e.jsxs(T,{justify:"space-between",align:"center",children:[e.jsx(kt,{as:"h1",size:"xl",children:h?"記事編集":"新規記事作成"}),e.jsxs(T,{spacing:4,children:[e.jsxs(K,{display:"flex",alignItems:"center",width:"auto",children:[e.jsx(W,{htmlFor:"publish-switch",mb:"0",mr:2,children:"公開する"}),e.jsx(Ke,{id:"publish-switch",isChecked:x.status==="published",onChange:t=>F("status",t.target.checked?"published":"draft")})]}),e.jsx(w,{variant:"outline",onClick:()=>c("/admin/posts"),children:"キャンセル"}),e.jsx(w,{variant:"outline",onClick:$,isLoading:m,children:"下書き保存"}),e.jsx(w,{colorScheme:"brand",onClick:z,isLoading:m,children:h?"更新":"作成"})]})]}),e.jsxs(N,{className:"crystal-glass crystal-glass--surface",p:4,borderRadius:"md",children:[e.jsxs(K,{isRequired:!0,children:[e.jsx(W,{mb:1,children:"タイトル"}),e.jsx(se,{value:x.title,onChange:t=>F("title",t.target.value),placeholder:"記事のタイトル",size:"md"})]}),e.jsx(T,{justify:"flex-end",mt:2,children:e.jsx(w,{size:"sm",variant:"ghost",onClick:S.onToggle,children:S.isOpen?"詳細設定を隠す":"詳細設定を表示"})})]}),e.jsx(We,{in:S.isOpen,animateOpacity:!0,children:e.jsxs(T,{spacing:4,align:"start",className:"crystal-glass crystal-glass--elevated",p:4,borderRadius:"md",children:[e.jsxs(K,{flex:1,children:[e.jsx(W,{children:"スラッグ"}),e.jsx(se,{value:x.slug,onChange:t=>F("slug",t.target.value),placeholder:"自動生成: YYYYMMDD"})]}),e.jsxs(K,{flex:2,children:[e.jsx(W,{children:"概要"}),e.jsx($e,{value:x.excerpt,onChange:t=>F("excerpt",t.target.value),placeholder:"記事の概要（任意）",rows:2})]}),e.jsxs(K,{flex:2,children:[e.jsx(W,{children:"アイキャッチ画像（D&D / PASTE 可）"}),e.jsx(N,{onDrop:q,onDragOver:M,onDragLeave:J,p:3,border:"2px dashed",borderColor:C?"purple.400":"gray.300",borderRadius:"md",bg:C?"purple.50":"transparent",children:e.jsxs(T,{align:"center",spacing:3,children:[x.featured_image&&e.jsx(xe,{src:x.featured_image,alt:"preview",boxSize:"64px",objectFit:"cover",borderRadius:"md"}),e.jsx(se,{value:x.featured_image,onChange:t=>F("featured_image",t.target.value),onPaste:U,placeholder:"画像URL または ここに画像をペースト / ドロップ"}),e.jsx("input",{ref:P,type:"file",accept:"image/*",style:{display:"none"},onChange:_}),e.jsx(w,{size:"sm",variant:"outline",onClick:()=>{var t;return(t=P.current)==null?void 0:t.click()},children:"選択"}),e.jsx(w,{size:"sm",variant:"ghost",onClick:async()=>{await O(),v.onOpen()},children:"一覧"})]})})]})]})}),e.jsx(te,{}),e.jsx(N,{className:"crystal-glass crystal-glass--elevated",p:4,borderRadius:"md",children:e.jsxs(K,{isRequired:!0,children:[e.jsx(W,{children:"本文（Markdown）"}),e.jsx(zt,{value:x.content,onChange:t=>F("content",t),postId:(A=i==null?void 0:i.id)==null?void 0:A.toString()})]})})]})}),e.jsxs(Te,{isOpen:v.isOpen,onClose:v.onClose,size:"xl",children:[e.jsx(Be,{}),e.jsxs(He,{children:[e.jsx(Oe,{children:"アップロード済み画像から選択"}),e.jsx(ye,{}),e.jsxs(Ue,{children:[e.jsx(jt,{columns:{base:3,md:4},spacing:3,children:k.map(t=>e.jsx(N,{border:"1px solid",borderColor:"gray.200",borderRadius:"md",overflow:"hidden",cursor:"pointer",onClick:()=>{F("featured_image",t),v.onClose()},children:e.jsx(xe,{src:t,alt:"image",objectFit:"cover",w:"100%",h:"80px"})},t))}),k.length===0&&e.jsx(N,{color:"gray.500",mt:2,children:"画像が見つかりません。記事本文で画像を貼り付けると候補に表示されます。"})]})]})]})]})};export{Kt as default};
//# sourceMappingURL=PostEditor-BEFZDYQ0.js.map
